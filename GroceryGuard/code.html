<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">   1
</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">ECE 5725, Fall 2017</span>
<span style="color: #DD4422">&quot;Grocery Guard&quot;</span>
<span style="color: #DD4422">Cameron Schultz (cjs342) and Dev Sanghvi (dys27)</span>
<span style="color: #DD4422">December 7, 2017</span>
<span style="color: #DD4422">Description: This code drives the front end user interface for the Grocery Guard</span>
<span style="color: #DD4422">             device. Communicates with a PostgreSQL back end stored locally on</span>
<span style="color: #DD4422">             the Raspberry Pi. Code should be run with no arguments on the Raspberry</span>
<span style="color: #DD4422">             Pi device that contains the database. UI animation screens are under the </span>
<span style="color: #DD4422">             &quot;User Interface Methods&quot;section. Backend communication, set interpretation, </span>
<span style="color: #DD4422">             and other helper methods are under the &quot;Functional Methods&quot; section.</span>
<span style="color: #DD4422">External packages used:</span>
<span style="color: #DD4422">      - numpy</span>
<span style="color: #DD4422">      - pygame</span>
<span style="color: #DD4422">      - zbar</span>
<span style="color: #DD4422">      - psycopg2</span>
<span style="color: #DD4422">      - RPi.GPIO</span>
<span style="color: #DD4422">&quot;&quot;&quot;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">os</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">pygame</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">pygame.locals</span> <span style="color: #008800; font-weight: bold">import</span> <span style="color: #333333">*</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">pygame.camera</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">pygame.surfarray</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">numpy</span> <span style="color: #008800; font-weight: bold">as</span> <span style="color: #0e84b5; font-weight: bold">np</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">zbar</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">zbar.misc</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">time</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">psycopg2</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">datetime</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">subprocess</span> <span style="color: #008800; font-weight: bold">import</span> call
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">RPi.GPIO</span> <span style="color: #008800; font-weight: bold">as</span> <span style="color: #0e84b5; font-weight: bold">GPIO</span>

<span style="color: #888888"># Initialize Environment Variables for TFT</span>
os<span style="color: #333333">.</span>putenv(<span style="background-color: #fff0f0">&#39;SDL_VIDEODRIVER&#39;</span>,<span style="background-color: #fff0f0">&#39;fbcon&#39;</span>)
os<span style="color: #333333">.</span>putenv(<span style="background-color: #fff0f0">&#39;SDL_FBDEV&#39;</span>,<span style="background-color: #fff0f0">&#39;/dev/fb1&#39;</span>)
os<span style="color: #333333">.</span>putenv(<span style="background-color: #fff0f0">&#39;SDL_MOUSEDRV&#39;</span>,<span style="background-color: #fff0f0">&#39;TSLIB&#39;</span>)
os<span style="color: #333333">.</span>putenv(<span style="background-color: #fff0f0">&#39;SDL_MOUSEDEV&#39;</span>,<span style="background-color: #fff0f0">&#39;/dev/input/touchscreen&#39;</span>)

pygame<span style="color: #333333">.</span>init()

<span style="color: #888888"># Hide mouse on touchscreen</span>
pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>set_visible(<span style="color: #007020">False</span>)


<span style="color: #888888">#Globals</span>
SIZE <span style="color: #333333">=</span> WIDTH, HEIGHT <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">320</span>,<span style="color: #0000DD; font-weight: bold">240</span>            <span style="color: #888888">#PiTFT Resolution</span>

BLACK <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>]
RED <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>]
GREEN <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">0</span>]
BLUE <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">255</span>]
WHITE <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>]

CAM_NAME<span style="color: #333333">=</span><span style="background-color: #fff0f0">&#39;/dev/video0&#39;</span>
CAM_RES<span style="color: #333333">=</span>(<span style="color: #0000DD; font-weight: bold">640</span>,<span style="color: #0000DD; font-weight: bold">480</span>)  <span style="color: #888888"># webcam resolution</span>

screen <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>set_mode(SIZE)
WINDOW <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">62</span> <span style="color: #888888">#display margins for text alignement</span>

<span style="color: #888888"># Set up GPIO 27 as &quot;bailout&quot; to desktop</span>
GPIO<span style="color: #333333">.</span>setmode(GPIO<span style="color: #333333">.</span>BCM)
GPIO<span style="color: #333333">.</span>setup(<span style="color: #0000DD; font-weight: bold">27</span>, GPIO<span style="color: #333333">.</span>IN, pull_up_down<span style="color: #333333">=</span>GPIO<span style="color: #333333">.</span>PUD_UP)
<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">GPIO27_callback</span>(channel):
   cmd <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;startx&#39;</span>
   call(cmd, shell<span style="color: #333333">=</span><span style="color: #007020">True</span>)

<span style="color: #888888"># Add threaded callback interrupt for GPIO 27</span>
GPIO<span style="color: #333333">.</span>add_event_detect(<span style="color: #0000DD; font-weight: bold">27</span>,GPIO<span style="color: #333333">.</span>FALLING,callback<span style="color: #333333">=</span>GPIO27_callback,bouncetime<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">300</span>)

<span style="color: #888888"># --------------- User Interface Methods ---------------- #</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">home_screen</span>():
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Animates the home screen for the Grocery Guard. Called on startup.</span>
<span style="color: #DD4422">   Continuously polls scan() to see if barcode detected.</span>
<span style="color: #DD4422">   Links to display_notifications, display_fridge, and display_recipes.</span>
<span style="color: #DD4422">   Power button in bottom right shuts down the pi.</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>

   my_font <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">40</span>)
   my_buttons <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;Display Items&#39;</span>:(WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>,<span style="color: #0000DD; font-weight: bold">50</span>),
               <span style="background-color: #fff0f0">&#39;Suggest Recipes&#39;</span>:(WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>,<span style="color: #0000DD; font-weight: bold">100</span>),
               <span style="background-color: #fff0f0">&#39;Notifications&#39;</span>:(WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>,<span style="color: #0000DD; font-weight: bold">150</span>)}

   pos <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>) <span style="color: #888888"># mouse position on click</span>

   start_time <span style="color: #333333">=</span> time<span style="color: #333333">.</span>time()
   delay <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">100</span> <span style="color: #888888"># barcode scanning interval</span>

   <span style="color: #888888"># animate and get events</span>
   <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
      <span style="color: #888888"># mouse/touchscreen input</span>
      <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
         <span style="color: #008800; font-weight: bold">if</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONDOWN):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
         <span style="color: #888888"># detect mouse clicks (trigger event when mouse released)</span>
         <span style="color: #008800; font-weight: bold">elif</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONUP):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
            x,y<span style="color: #333333">=</span>pos
            <span style="color: #888888">#power button</span>
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
               <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">290</span>:
                  <span style="color: #888888"># shut down the pi</span>
                  cmd <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;sudo shutdown -h now&#39;</span>
                  call(cmd, shell<span style="color: #333333">=</span><span style="color: #007020">True</span>)
            <span style="color: #888888">#Display Items</span>
            <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">25</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">75</span>:
               ingredients <span style="color: #333333">=</span> get_ingredients()
               display_fridge(ingredients,<span style="color: #0000DD; font-weight: bold">0</span>)
            <span style="color: #888888">#Suggest Recipes</span>
            <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">75</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">125</span>:
               recipes <span style="color: #333333">=</span> get_recipes()
               display_recipes(recipes)
            <span style="color: #888888">#Display Notifications</span>
            <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">125</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">175</span>:
               ingredients <span style="color: #333333">=</span> get_ingredients()
               notifications <span style="color: #333333">=</span> get_notifications(ingredients)
               display_notifications(notifications,<span style="color: #0000DD; font-weight: bold">0</span>)

      screen<span style="color: #333333">.</span>fill(BLACK) <span style="color: #888888"># Erase the Work space</span>

      <span style="color: #888888">#write text to screen</span>
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> my_buttons<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #888888"># draw power button</span>
      pygame<span style="color: #333333">.</span>draw<span style="color: #333333">.</span>circle(screen, RED, [WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">15</span>,HEIGHT<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">15</span>],<span style="color: #0000DD; font-weight: bold">15</span>)
      pygame<span style="color: #333333">.</span>draw<span style="color: #333333">.</span>circle(screen, WHITE, [WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">15</span>,HEIGHT<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">15</span>],<span style="color: #0000DD; font-weight: bold">12</span>,<span style="color: #0000DD; font-weight: bold">2</span>)
      pygame<span style="color: #333333">.</span>draw<span style="color: #333333">.</span>rect(screen, WHITE, (WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">16</span>,HEIGHT<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">32</span>,<span style="color: #0000DD; font-weight: bold">2</span>,<span style="color: #0000DD; font-weight: bold">14</span>))
      
      pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip() <span style="color: #888888"># display workspace on screen</span>
      
      <span style="color: #888888"># poll scan() for barcode hits</span>
      <span style="color: #008800; font-weight: bold">if</span> delay <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">0</span>:
         <span style="color: #007020">id</span> <span style="color: #333333">=</span> scan()
         <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">id</span> <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            <span style="color: #008800; font-weight: bold">print</span> <span style="color: #007020">str</span>(<span style="color: #007020">id</span>) <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; scanned&quot;</span>
            item <span style="color: #333333">=</span> get_item_name(<span style="color: #007020">id</span>)
            <span style="color: #008800; font-weight: bold">print</span> item, <span style="color: #007020">type</span>(item)
            display_item_added(item,<span style="color: #007020">id</span>)
         <span style="color: #888888"># reset scanning interval timer</span>
         delay <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">100</span>
         start_time<span style="color: #333333">=</span>time<span style="color: #333333">.</span>time()
      
      delay <span style="color: #333333">-=</span> <span style="color: #0000DD; font-weight: bold">1</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">display_fridge</span>(ingredients,starti):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Animates and displays the contents currently contained in the &#39;Fridge.&#39; These items </span>
<span style="color: #DD4422">   are scanned in using the barcode scanner.</span>
<span style="color: #DD4422">   ingredients must be formatted as a numpy array:</span>
<span style="color: #DD4422">      ingredients = np.asarray([ing1,ing2,ing3,...])</span>
<span style="color: #DD4422">      where ingi = &quot;Name amt+unit time to expire in days&quot;</span>
<span style="color: #DD4422">   starti is the index of ingredients from which to begin displaying</span>
<span style="color: #DD4422">   User may delete expired ingredients in their Fridge from this screen.</span>
<span style="color: #DD4422">   Links to home_screen(), display_notifications(), display_recipes()</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   
   my_font <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">30</span>)
   my_font2 <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">20</span>)

   <span style="color: #888888"># text display dictionaries</span>
   ing_list <span style="color: #333333">=</span> {}
   amt_list<span style="color: #333333">=</span>{}
   exp_list<span style="color: #333333">=</span>{}
   circle_list <span style="color: #333333">=</span> {}
   text_list<span style="color: #333333">=</span>{<span style="background-color: #fff0f0">&quot;Item                 Amount      Expiring in&quot;</span>:((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span>)}
   text_list[<span style="background-color: #fff0f0">&quot;-&quot;</span><span style="color: #333333">*</span>WINDOW]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">20</span>)
   NUM_ING <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">8</span> <span style="color: #888888">#number of ingredient to display per screen</span>

   <span style="color: #888888"># add each of the NUM_ING ingredients to the list</span>
   <span style="color: #888888"># add ingredients[starti:starti+NUM_ING]</span>
   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #007020">min</span>(ingredients<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">-</span>starti,NUM_ING)):
      <span style="color: #888888">#parse ingredient</span>
      tmp <span style="color: #333333">=</span> ingredients[starti<span style="color: #333333">+</span>i]
      tmp_list <span style="color: #333333">=</span> tmp<span style="color: #333333">.</span>split()
      
      <span style="color: #888888"># for all text-based dictionaries, entries are appended with a unique</span>
      <span style="color: #888888"># number of whitespaces to make each key unique</span>
      <span style="color: #888888"># structure of entries is dict[&quot;text to display&quot;] = (posx, posy)</span>
      ing_list[<span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">.</span>join(tmp_list[:<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">4</span>]) <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)
      amt_list[tmp_list[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">4</span>] <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)
      exp_list[tmp_list[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">3</span>] <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; days&quot;</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)

      <span style="color: #888888"># if ingredient expired, draw circle at its position</span>
      <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">float</span>(tmp_list[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">3</span>]) <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
         circle_list[<span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">.</span>join(tmp_list[:<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">4</span>])<span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">15</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)
      
   <span style="color: #888888"># determine if there are more ingredients to display after/before this screen</span>
   more <span style="color: #333333">=</span> <span style="color: #007020">True</span> <span style="color: #008800; font-weight: bold">if</span> ingredients<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">-</span>starti <span style="color: #333333">&gt;</span> NUM_ING <span style="color: #008800; font-weight: bold">else</span> <span style="color: #007020">False</span>
   prev <span style="color: #333333">=</span> <span style="color: #007020">True</span> <span style="color: #008800; font-weight: bold">if</span> starti <span style="color: #333333">&gt;</span> NUM_ING<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #007020">False</span>
   <span style="color: #888888"># add buttons accordingly</span>
   <span style="color: #008800; font-weight: bold">if</span> more:
      ing_list[<span style="background-color: #fff0f0">&#39;More Ingredients&#39;</span>] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>(NUM_ING<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">5</span>)
   <span style="color: #008800; font-weight: bold">elif</span> prev:
      ing_list[<span style="background-color: #fff0f0">&#39;Previous&#39;</span>] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>(NUM_ING<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">5</span>)

   <span style="color: #888888"># add static buttons</span>
   my_buttons <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;Menu&#39;</span>:(<span style="color: #0000DD; font-weight: bold">50</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Suggest Recipes&#39;</span>:(<span style="color: #0000DD; font-weight: bold">160</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Notifications&#39;</span>:(<span style="color: #0000DD; font-weight: bold">270</span>,<span style="color: #0000DD; font-weight: bold">220</span>)}

   <span style="color: #888888"># position of mouse click</span>
   pos <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>) 
   
   <span style="color: #888888"># animate and get events</span>
   <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
      <span style="color: #888888">#mouse/touchscreen input</span>
      <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
         <span style="color: #008800; font-weight: bold">if</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONDOWN):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
         <span style="color: #008800; font-weight: bold">elif</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONUP):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
            x,y<span style="color: #333333">=</span>pos
            <span style="color: #888888">#check if circle clicked</span>
            <span style="color: #008800; font-weight: bold">if</span> x <span style="color: #333333">&gt;</span> WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">50</span>:
               <span style="color: #008800; font-weight: bold">for</span> ing,pos <span style="color: #000000; font-weight: bold">in</span> circle_list<span style="color: #333333">.</span>items():
                  <span style="color: #008800; font-weight: bold">if</span> pos[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">15</span> <span style="color: #333333">&lt;</span> y <span style="color: #333333">&lt;</span> pos[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">15</span>:
                     <span style="color: #888888">#print &quot;deleting &quot; + ing</span>
                     <span style="color: #888888"># delete item from Fridge</span>
                     <span style="color: #007020">id</span> <span style="color: #333333">=</span> get_item_id(ing<span style="color: #333333">.</span>strip())
                     update_fridge(<span style="color: #007020">id</span>,<span style="color: #0000DD; font-weight: bold">0</span>) <span style="color: #888888"># when 0 passed as arg[1], update_fridge deletes</span>
                     <span style="color: #888888">#refresh ingredient list and display at same start index</span>
                     new_ingredients <span style="color: #333333">=</span> get_ingredients()
                     display_fridge(new_ingredients,starti)
            <span style="color: #888888">#more ingredients</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #0000DD; font-weight: bold">185</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">205</span>:
               <span style="color: #008800; font-weight: bold">if</span> more:
                  <span style="color: #888888"># display ingredients starti + NUM_ING thru starti + 2*NUM_ING-1</span>
                  display_fridge(ingredients,starti<span style="color: #333333">+</span>NUM_ING)
               <span style="color: #008800; font-weight: bold">elif</span> prev:
                  <span style="color: #888888"># display ingredients starti-NUM_ING thru starti-1</span>
                  display_fridge(ingredients,starti<span style="color: #333333">-</span>NUM_ING)

            <span style="color: #888888">#Display static buttons</span>
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
               <span style="color: #888888"># back to menu</span>
               <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">75</span>:
                  home_screen()
               <span style="color: #888888"># Suggest Recipes</span>
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">100</span><span style="color: #333333">&lt;</span>x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">225</span>:
                  recipes <span style="color: #333333">=</span> get_recipes()
                  display_recipes(recipes)
               <span style="color: #888888">#Display Notifications</span>
               <span style="color: #008800; font-weight: bold">elif</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">230</span>:
                  notifications <span style="color: #333333">=</span> get_notifications(ingredients)
                  display_notifications(notifications,<span style="color: #0000DD; font-weight: bold">0</span>)

      screen<span style="color: #333333">.</span>fill(BLACK) <span style="color: #888888"># Erase the Work space</span>

      <span style="color: #888888"># display text items</span>
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> my_buttons<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> ing_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> amt_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">170</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> exp_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">225</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)
      <span style="color: #888888">#draw circles</span>
      <span style="color: #008800; font-weight: bold">for</span> index,pos <span style="color: #000000; font-weight: bold">in</span> circle_list<span style="color: #333333">.</span>items():
         pygame<span style="color: #333333">.</span>draw<span style="color: #333333">.</span>circle(screen, RED, pos,<span style="color: #0000DD; font-weight: bold">10</span>)

      pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip()

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">display_recipes</span>(recipes):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Animates and displays the suggested recipes. This list is determined by the </span>
<span style="color: #DD4422">   get_recipes() function.</span>
<span style="color: #DD4422">   recipes is formatted as a numpy array</span>
<span style="color: #DD4422">      recipes = np.asarray([rec1,rec2,...],[id1,id2,...])</span>
<span style="color: #DD4422">      where reci = &#39;name %match&#39;</span>
<span style="color: #DD4422">      %match = (#ing in fridge used by recipe)/(# total ing used by recipe)</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   <span style="color: #888888"># parse recipes</span>
   ids <span style="color: #333333">=</span> recipes[<span style="color: #0000DD; font-weight: bold">1</span>]
   recipes <span style="color: #333333">=</span> recipes[<span style="color: #0000DD; font-weight: bold">0</span>]

   text_list<span style="color: #333333">=</span>{<span style="background-color: #fff0f0">&quot;Recipe                          Percent Match&quot;</span>:((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span>)}
   text_list[<span style="background-color: #fff0f0">&quot;-&quot;</span><span style="color: #333333">*</span>WINDOW]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">20</span>)
   
   my_font <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">25</span>)
   my_font2 <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">20</span>)
   rec_list <span style="color: #333333">=</span> {}
   match_list <span style="color: #333333">=</span> {}
   
   <span style="color: #888888"># dictionary of recipes unsorted_dict[recipe name] = %match</span>
   unsorted_dict <span style="color: #333333">=</span> {}
   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">5</span>):
      tmp <span style="color: #333333">=</span> recipes[i]
      tmp_list <span style="color: #333333">=</span> tmp<span style="color: #333333">.</span>split()
      match <span style="color: #333333">=</span> <span style="color: #007020">float</span>(tmp_list[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>])<span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">100</span>
      var <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39; &#39;</span><span style="color: #333333">.</span>join(tmp_list[:<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>])
      unsorted_dict[var] <span style="color: #333333">=</span> (match,ids[i])

   <span style="color: #888888"># sort the dictionary by %match</span>
   sorted_list <span style="color: #333333">=</span> <span style="color: #007020">sorted</span>(unsorted_dict, key<span style="color: #333333">=</span>unsorted_dict<span style="color: #333333">.</span>get, reverse<span style="color: #333333">=</span><span style="color: #007020">True</span>)
   
   i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #888888"># index used to create unique keys</span>
   <span style="color: #888888"># add elements of sorted_list to rec_list and match_list in order</span>
   <span style="color: #008800; font-weight: bold">for</span> ing <span style="color: #000000; font-weight: bold">in</span> sorted_list:
      match <span style="color: #333333">=</span> <span style="color: #007020">float</span>(unsorted_dict[ing][<span style="color: #0000DD; font-weight: bold">0</span>])
      <span style="color: #008800; font-weight: bold">if</span> match <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">100</span>:
         match_str <span style="color: #333333">=</span> <span style="color: #007020">str</span>(match)[:<span style="color: #0000DD; font-weight: bold">3</span>]
      <span style="color: #008800; font-weight: bold">else</span>:
         match_str <span style="color: #333333">=</span> <span style="color: #007020">str</span>(match)[:<span style="color: #0000DD; font-weight: bold">2</span>]
      var <span style="color: #333333">=</span> ing
      <span style="color: #888888"># if text too long, crop</span>
      <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(var) <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">18</span>:
         var <span style="color: #333333">=</span> var[:<span style="color: #0000DD; font-weight: bold">16</span>] <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39;...&#39;</span>
      rec_list[var <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">35</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">33</span><span style="color: #333333">*</span>i)
      match_list[match_str <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;%&quot;</span>  <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">35</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">33</span><span style="color: #333333">*</span>i)
      i<span style="color: #333333">+=</span><span style="color: #0000DD; font-weight: bold">1</span>

   <span style="color: #888888"># static buttons</span>
   my_buttons <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;Menu&#39;</span>:(<span style="color: #0000DD; font-weight: bold">50</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Display Items&#39;</span>:(<span style="color: #0000DD; font-weight: bold">160</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Notifications&#39;</span>:(<span style="color: #0000DD; font-weight: bold">270</span>,<span style="color: #0000DD; font-weight: bold">220</span>)}

   <span style="color: #888888"># mouse position</span>
   pos <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>) 
   
   <span style="color: #888888"># animate and get events</span>
   <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
      <span style="color: #888888">#mouse/touchscreen input</span>
      <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
         <span style="color: #008800; font-weight: bold">if</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONDOWN):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
         <span style="color: #008800; font-weight: bold">elif</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONUP):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
            x,y<span style="color: #333333">=</span>pos
            <span style="color: #888888">#go to specific recipe screen</span>
            <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">50</span>:
               <span style="color: #008800; font-weight: bold">if</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">45</span>:
                  <span style="color: #888888"># get appropriate recipe id </span>
                  display_single_recipe(unsorted_dict[sorted_list[<span style="color: #0000DD; font-weight: bold">0</span>]][<span style="color: #0000DD; font-weight: bold">1</span>])
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">55</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">80</span>:
                  display_single_recipe(unsorted_dict[sorted_list[<span style="color: #0000DD; font-weight: bold">1</span>]][<span style="color: #0000DD; font-weight: bold">1</span>])
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">90</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">115</span>:
                  display_single_recipe(unsorted_dict[sorted_list[<span style="color: #0000DD; font-weight: bold">2</span>]][<span style="color: #0000DD; font-weight: bold">1</span>])
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">120</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">145</span>:
                  display_single_recipe(unsorted_dict[sorted_list[<span style="color: #0000DD; font-weight: bold">3</span>]][<span style="color: #0000DD; font-weight: bold">1</span>])
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">155</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">180</span>:
                  display_single_recipe(unsorted_dict[sorted_list[<span style="color: #0000DD; font-weight: bold">4</span>]][<span style="color: #0000DD; font-weight: bold">1</span>])
            <span style="color: #888888"># Static buttons</span>
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
               <span style="color: #888888">#back to menu   </span>
               <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">75</span>:
                  home_screen()
               <span style="color: #888888">#Display Fridge</span>
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">115</span><span style="color: #333333">&lt;</span>x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
                  ingredients <span style="color: #333333">=</span> get_ingredients()
                  display_fridge(ingredients,<span style="color: #0000DD; font-weight: bold">0</span>)
               <span style="color: #888888">#Display Notifications</span>
               <span style="color: #008800; font-weight: bold">elif</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">230</span>:
                  ingredients <span style="color: #333333">=</span> get_ingredients()
                  notifications <span style="color: #333333">=</span> get_notifications(ingredients)
                  display_notifications(notifications,<span style="color: #0000DD; font-weight: bold">0</span>)

      screen<span style="color: #333333">.</span>fill(BLACK) <span style="color: #888888"># Erase the Work space</span>
      <span style="color: #888888"># write text</span>
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> my_buttons<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> rec_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> match_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">230</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip()

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">display_notifications</span>(notifications, starti):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Animates and displays the notifications screen. Notifications come from get_notifications()</span>
<span style="color: #DD4422">   notifications is formatted as a numpy array</span>
<span style="color: #DD4422">      notifications = np.asarray([not1,not2,...])</span>
<span style="color: #DD4422">      where noti = &quot;ingredient;message&quot;</span>
<span style="color: #DD4422">   starti is the starting index of notifications from which to display on this screen</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   
   my_font <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">30</span>)
   my_font2 <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">20</span>)

   text_list<span style="color: #333333">=</span>{<span style="background-color: #fff0f0">&quot;Item                 Message&quot;</span>:((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span>)}
   text_list[<span style="background-color: #fff0f0">&quot;-&quot;</span><span style="color: #333333">*</span>WINDOW]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">20</span>)
   ing_list <span style="color: #333333">=</span> {}
   not_list <span style="color: #333333">=</span> {}
   circle_list <span style="color: #333333">=</span> {}
   NUM_NOT <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">8</span> <span style="color: #888888">#number of notifications to display per screen</span>
   <span style="color: #888888"># parse notifcations and add to text lists</span>
   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #007020">min</span>(notifications<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">-</span>starti,NUM_NOT)):
      tmp <span style="color: #333333">=</span> notifications[starti<span style="color: #333333">+</span>i]
      tmp_list <span style="color: #333333">=</span> tmp<span style="color: #333333">.</span>split(<span style="background-color: #fff0f0">&quot;;&quot;</span>)
      ing_list[tmp_list[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">+</span><span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)
      not_list[tmp_list[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">+</span><span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)
      <span style="color: #888888"># if ingredient expired, draw a circle next to it</span>
      <span style="color: #008800; font-weight: bold">if</span> tmp_list[<span style="color: #0000DD; font-weight: bold">1</span>][:<span style="color: #0000DD; font-weight: bold">7</span>] <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;expired&quot;</span>:
         circle_list[tmp_list[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">+</span><span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">30</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)
   
   <span style="color: #888888"># determine if more notifications exist on next/prev screen</span>
   more <span style="color: #333333">=</span> <span style="color: #007020">True</span> <span style="color: #008800; font-weight: bold">if</span> notifications<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">-</span>starti <span style="color: #333333">&gt;</span> NUM_NOT <span style="color: #008800; font-weight: bold">else</span> <span style="color: #007020">False</span>
   prev <span style="color: #333333">=</span> <span style="color: #007020">True</span> <span style="color: #008800; font-weight: bold">if</span> starti <span style="color: #333333">&gt;</span> NUM_NOT<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #007020">False</span>
   <span style="color: #888888"># and add appropriate buttons</span>
   <span style="color: #008800; font-weight: bold">if</span> more:
      ing_list[<span style="background-color: #fff0f0">&#39;More notifications&#39;</span>] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>(NUM_NOT<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">5</span>)
   <span style="color: #008800; font-weight: bold">elif</span> prev:
      ing_list[<span style="background-color: #fff0f0">&#39;Previous&#39;</span>] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>(NUM_NOT<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">5</span>)

   <span style="color: #888888"># add static buttons</span>
   my_buttons <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;Menu&#39;</span>:(<span style="color: #0000DD; font-weight: bold">50</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Suggest Recipes&#39;</span>:(<span style="color: #0000DD; font-weight: bold">160</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Display Items&#39;</span>:(<span style="color: #0000DD; font-weight: bold">270</span>,<span style="color: #0000DD; font-weight: bold">220</span>)}

   pos <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>) 
   
   <span style="color: #888888"># animate and get events</span>
   <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
      <span style="color: #888888">#mouse/touchscreen input</span>
      <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
         <span style="color: #008800; font-weight: bold">if</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONDOWN):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
         <span style="color: #008800; font-weight: bold">elif</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONUP):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
            x,y<span style="color: #333333">=</span>pos
            <span style="color: #888888">#check if circle clicked</span>
            <span style="color: #008800; font-weight: bold">if</span> x <span style="color: #333333">&gt;</span> WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">50</span>:
               <span style="color: #008800; font-weight: bold">for</span> ing,pos <span style="color: #000000; font-weight: bold">in</span> circle_list<span style="color: #333333">.</span>items():
                  <span style="color: #008800; font-weight: bold">if</span> pos[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">15</span> <span style="color: #333333">&lt;</span> y <span style="color: #333333">&lt;</span> pos[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">15</span>:
                     <span style="color: #888888">#print &quot;deleting &quot;, ing</span>
                     <span style="color: #888888"># delete item from fridge</span>
                     <span style="color: #007020">id</span> <span style="color: #333333">=</span> get_item_id(ing<span style="color: #333333">.</span>strip())
                     update_fridge(<span style="color: #007020">id</span>,<span style="color: #0000DD; font-weight: bold">0</span>)
                     <span style="color: #888888"># refresh ingredients list</span>
                     new_ingredients <span style="color: #333333">=</span> get_ingredients()
                     new_notifications <span style="color: #333333">=</span> get_notifications(new_ingredients)
                     display_notifications(new_notifications,starti)
            <span style="color: #888888">#more notifications</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #0000DD; font-weight: bold">185</span><span style="color: #333333">&lt;</span>y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">205</span>:
               <span style="color: #008800; font-weight: bold">if</span> more:
                  <span style="color: #888888"># display notifications starti + NUM_NOT thru starti + 2*NUM_NOT-1</span>
                  display_notifications(notifications,starti<span style="color: #333333">+</span>NUM_NOT)
               <span style="color: #008800; font-weight: bold">elif</span> prev:
                  <span style="color: #888888"># display notifications starti-NUM_NOT thru starti-1</span>
                  display_notifications(notifications,starti<span style="color: #333333">-</span>NUM_NOT)
            <span style="color: #888888">#Display Items</span>
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
               <span style="color: #888888">#back to menu   </span>
               <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">75</span>:
                  home_screen()
               <span style="color: #888888">#Suggest Recipes</span>
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">100</span><span style="color: #333333">&lt;</span>x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">225</span>:
                  recipes <span style="color: #333333">=</span> get_recipes()
                  display_recipes(recipes)
               <span style="color: #888888">#Display Fridge</span>
               <span style="color: #008800; font-weight: bold">elif</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">230</span>:
                  ingredients <span style="color: #333333">=</span> get_ingredients()
                  display_fridge(ingredients,<span style="color: #0000DD; font-weight: bold">0</span>)

      screen<span style="color: #333333">.</span>fill(BLACK) <span style="color: #888888"># Erase the Work space</span>
      
      <span style="color: #888888"># display text items</span>
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> my_buttons<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> not_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">150</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> ing_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)
      <span style="color: #888888"># draw circles</span>
      <span style="color: #008800; font-weight: bold">for</span> index,pos <span style="color: #000000; font-weight: bold">in</span> circle_list<span style="color: #333333">.</span>items():
         pygame<span style="color: #333333">.</span>draw<span style="color: #333333">.</span>circle(screen, RED, pos,<span style="color: #0000DD; font-weight: bold">10</span>)

      pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip()
   
<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">display_single_recipe</span>(<span style="color: #007020">id</span>):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Animates and displays the single recipe screen. The recipe to display is specified</span>
<span style="color: #DD4422">   by its id. The id is extracted from the Postgres backend.</span>
<span style="color: #DD4422">   User may &quot;cook&quot; the recipe, which subtracts the amounts used from the Fridge.</span>
<span style="color: #DD4422">   Links to display_recipes(), display_instruction()</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>

   <span style="color: #888888"># connect to Postgres</span>
   conn <span style="color: #333333">=</span> psycopg2<span style="color: #333333">.</span>connect(<span style="background-color: #fff0f0">&#39;dbname=grocery_guard&#39;</span>)
   cur <span style="color: #333333">=</span> conn<span style="color: #333333">.</span>cursor()

   <span style="color: #888888"># fetch name of recipe, ingredients used, amounts used, instructions, and image</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select name,ingredients,amounts,instructions,image from recipes where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span><span style="color: #007020">str</span>(<span style="color: #007020">id</span>))
   data <span style="color: #333333">=</span> cur<span style="color: #333333">.</span>fetchone()

   <span style="color: #888888"># parse data</span>
   name <span style="color: #333333">=</span> data[<span style="color: #0000DD; font-weight: bold">0</span>]
   ingredients <span style="color: #333333">=</span> data[<span style="color: #0000DD; font-weight: bold">1</span>]
   quantities <span style="color: #333333">=</span> data[<span style="color: #0000DD; font-weight: bold">2</span>]
   instructions <span style="color: #333333">=</span> data[<span style="color: #0000DD; font-weight: bold">3</span>]<span style="color: #333333">.</span>split(<span style="background-color: #fff0f0">&quot;</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">&quot;</span>) <span style="color: #888888">#instructions separated by line carriage in db</span>
   <span style="color: #888888">#combine quantites and ingredients into amounts. This is what is displayed</span>
   amounts<span style="color: #333333">=</span>[<span style="background-color: #fff0f0">&#39;&#39;</span>]<span style="color: #333333">*</span><span style="color: #007020">len</span>(ingredients)
   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #007020">len</span>(ingredients)):
      <span style="color: #008800; font-weight: bold">print</span> <span style="color: #007020">str</span>(<span style="color: #007020">int</span>(ingredients[i]))
      cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select name from codes where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">str</span>(<span style="color: #007020">int</span>(ingredients[i])))
      amounts[i] <span style="color: #333333">=</span> <span style="color: #007020">str</span>(quantities[i]) <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; &#39;</span> <span style="color: #333333">+</span> cur<span style="color: #333333">.</span>fetchone()[<span style="color: #0000DD; font-weight: bold">0</span>]
   
   recipe <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray([[name<span style="color: #333333">.</span>title()],instructions,amounts])

   my_font <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">26</span>)
   my_font2 <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">20</span>)

   text_list<span style="color: #333333">=</span>{recipe[<span style="color: #0000DD; font-weight: bold">0</span>][<span style="color: #0000DD; font-weight: bold">0</span>]:((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span>)}
   text_list[<span style="background-color: #fff0f0">&quot;-&quot;</span><span style="color: #333333">*</span>WINDOW]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">20</span>)
   text_list[<span style="background-color: #fff0f0">&quot;Ingredients:&quot;</span>]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">30</span>)
   text_list2<span style="color: #333333">=</span>{}
   <span style="color: #888888"># separate ingredients+amounts into two columns</span>
   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #007020">len</span>(amounts)):
      <span style="color: #008800; font-weight: bold">if</span> i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">6</span>:
         text_list[amounts[i]<span style="color: #333333">+</span><span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">50</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)
      <span style="color: #008800; font-weight: bold">else</span>:
         text_list2[amounts[i]<span style="color: #333333">+</span><span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #333333">=</span> ((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">50</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>(i<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">6</span>))

   <span style="color: #888888"># static buttons</span>
   my_buttons <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;Show Instructions&#39;</span>:(<span style="color: #0000DD; font-weight: bold">75</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Back to Recipes&#39;</span>:(<span style="color: #0000DD; font-weight: bold">250</span>,<span style="color: #0000DD; font-weight: bold">220</span>)}

   pos <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>) 

   <span style="color: #888888">#close connection</span>
   cur<span style="color: #333333">.</span>close()
   conn<span style="color: #333333">.</span>close()
   cooked <span style="color: #333333">=</span> <span style="color: #007020">False</span>

   <span style="color: #888888"># animate and get events</span>
   <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
      <span style="color: #888888">#mouse/touchscreen input</span>
      <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
         <span style="color: #008800; font-weight: bold">if</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONDOWN):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
         <span style="color: #008800; font-weight: bold">elif</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONUP):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
            x,y<span style="color: #333333">=</span>pos
            <span style="color: #888888">#cook recipe</span>
            <span style="color: #008800; font-weight: bold">if</span> y <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">170</span> <span style="color: #000000; font-weight: bold">and</span> <span style="color: #0000DD; font-weight: bold">130</span><span style="color: #333333">&lt;</span>x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">190</span> <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> cooked:
               <span style="color: #888888">#note: cooked variable allows recipe to be cooked only a single time</span>
               cooked <span style="color: #333333">=</span> <span style="color: #007020">True</span>
               <span style="color: #888888"># subtract amounts used from fridge</span>
               <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #007020">len</span>(ingredients)):
                  <span style="color: #888888">#print ingredients[i], quantities[i]</span>
                  update_fridge(ingredients[i],quantities[i])
            <span style="color: #888888"># static buttons</span>
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
               <span style="color: #888888">#back to menu   </span>
               <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">140</span>:
                  display_instruction(instructions,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #007020">id</span>,<span style="color: #007020">False</span>)
               <span style="color: #888888">#suggest recipes</span>
               <span style="color: #008800; font-weight: bold">elif</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">190</span>:
                  recipes <span style="color: #333333">=</span> get_recipes()
                  display_recipes(recipes)

      screen<span style="color: #333333">.</span>fill(BLACK) <span style="color: #888888"># Erase the Work space</span>
      <span style="color: #888888"># display text</span>
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> my_buttons<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)
      
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list2<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">175</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #888888"># determine button properties depending on if cooked or not</span>
      <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> cooked:
         text <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;COOK!&quot;</span>
         button_color <span style="color: #333333">=</span> RED
      <span style="color: #008800; font-weight: bold">else</span>:
         text <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;COOKED!&quot;</span>
         button_color <span style="color: #333333">=</span> GREEN

      <span style="color: #888888"># draw cook/cooked button</span>
      pygame<span style="color: #333333">.</span>draw<span style="color: #333333">.</span>circle(screen, button_color, [WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>,HEIGHT<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">40</span>],<span style="color: #0000DD; font-weight: bold">30</span>)
      text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(text, <span style="color: #007020">True</span>, WHITE)
      text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>(WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>,HEIGHT<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">40</span>))
      screen<span style="color: #333333">.</span>blit(text_surface,text_rect)
      pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip()
   
<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">display_instruction</span>(instructions,starti,<span style="color: #007020">id</span>,s):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Display a single instruction in a recipe.</span>
<span style="color: #DD4422">   instructions contains the full list of instructions</span>
<span style="color: #DD4422">   starti indicates the index within instructions to display</span>
<span style="color: #DD4422">   id is the id of the recipe from which the instruction is taken</span>
<span style="color: #DD4422">   s is a Boolean indicating whether or not speaking is enabled</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   
   <span style="color: #888888"># define speaking bash command</span>
   cmd_beg <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;espeak -s150 &#39;</span> 
   cmd_end <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39; | aplay /home/pi/GroceryGuard/Text.wav 2&gt;/dev/null &amp;&#39;</span>
   cmd_out <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;--stdout &gt; /home/pi/GroceryGuard/Text.wav &#39;</span>
   
   <span style="color: #888888"># replace spaces with _ in instruction text so epseak can interpret</span>
   instructions1 <span style="color: #333333">=</span> instructions[starti]<span style="color: #333333">.</span>replace(<span style="background-color: #fff0f0">&#39; &#39;</span>,<span style="background-color: #fff0f0">&#39;_&#39;</span>)
   my_font <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">30</span>)
   my_font2 <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">20</span>)

   text_list<span style="color: #333333">=</span>{<span style="background-color: #fff0f0">&quot;Step &quot;</span> <span style="color: #333333">+</span> <span style="color: #007020">str</span>(starti<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>):((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span>)}
   text_list[<span style="background-color: #fff0f0">&quot;-&quot;</span><span style="color: #333333">*</span>(WINDOW<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">5</span>)]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">20</span>)

   <span style="color: #888888">#parse step and add to text_list</span>
   instr <span style="color: #333333">=</span> instructions[starti]
   wndw <span style="color: #333333">=</span> WINDOW<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">25</span> <span style="color: #888888"># truncated text margin window</span>
   
   <span style="color: #888888">#determine the number of blocks used to display the instruction</span>
   blocks <span style="color: #333333">=</span> <span style="color: #007020">int</span>(np<span style="color: #333333">.</span>ceil(<span style="color: #007020">float</span>(<span style="color: #007020">len</span>(instr))<span style="color: #333333">/</span>(wndw)))
   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(blocks):
      text <span style="color: #333333">=</span> instr[wndw<span style="color: #333333">*</span>i:wndw<span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)]<span style="color: #333333">.</span>strip()
      text_list[text <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">*</span>(i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">20</span><span style="color: #333333">*</span>i)

   <span style="color: #888888"># determine if more instructions exist on next/prev screen</span>
   more <span style="color: #333333">=</span> <span style="color: #007020">True</span> <span style="color: #008800; font-weight: bold">if</span> starti<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">&lt;</span> <span style="color: #007020">len</span>(instructions)<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #007020">False</span>
   prev <span style="color: #333333">=</span> <span style="color: #007020">True</span> <span style="color: #008800; font-weight: bold">if</span> starti <span style="color: #333333">!=</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #007020">False</span>
   
   <span style="color: #888888"># static buttons</span>
   my_buttons <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;Back to Recipe&#39;</span>:(<span style="color: #0000DD; font-weight: bold">160</span>,<span style="color: #0000DD; font-weight: bold">220</span>)}
   speech_button<span style="color: #333333">=</span>{<span style="background-color: #fff0f0">&#39;Toggle Speech&#39;</span>:((WIDTH<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">50</span>),<span style="color: #0000DD; font-weight: bold">10</span>)}

   <span style="color: #008800; font-weight: bold">if</span> more:
      my_buttons[<span style="background-color: #fff0f0">&quot;Next Step&quot;</span>] <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">270</span>,<span style="color: #0000DD; font-weight: bold">220</span>)
   <span style="color: #008800; font-weight: bold">if</span> prev:
      my_buttons[<span style="background-color: #fff0f0">&quot;Previous Step&quot;</span>] <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">50</span>,<span style="color: #0000DD; font-weight: bold">220</span>)

   
   pos <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>) 
   first<span style="color: #333333">=</span><span style="color: #007020">True</span> <span style="color: #888888"># first time through loop. Should call speak only on this iteration</span>
   speak <span style="color: #333333">=</span> s
   
   <span style="color: #888888"># animate screen and get inputs</span>
   <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
      button_color <span style="color: #333333">=</span> GREEN <span style="color: #008800; font-weight: bold">if</span> speak <span style="color: #008800; font-weight: bold">else</span> RED
      <span style="color: #888888">#mouse/touchscreen input</span>
      <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
         <span style="color: #008800; font-weight: bold">if</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONDOWN):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
         <span style="color: #008800; font-weight: bold">elif</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONUP):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
            x,y<span style="color: #333333">=</span>pos
            
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
               <span style="color: #888888">#previous step  </span>
               <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">100</span> <span style="color: #000000; font-weight: bold">and</span> prev:
                  call(<span style="background-color: #fff0f0">&quot;kill -9 $(pgrep aplay)&quot;</span>,shell<span style="color: #333333">=</span><span style="color: #007020">True</span>) <span style="color: #888888">#stop speaking</span>
                  display_instruction(instructions,starti<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>,<span style="color: #007020">id</span>,speak)
               <span style="color: #888888"># back to recipe screen</span>
               <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #0000DD; font-weight: bold">100</span><span style="color: #333333">&lt;</span>x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">225</span>:
                  call(<span style="background-color: #fff0f0">&quot;kill -9 $(pgrep aplay)&quot;</span>,shell<span style="color: #333333">=</span><span style="color: #007020">True</span>) <span style="color: #888888">#stop speaking</span>
                  display_single_recipe(<span style="color: #007020">id</span>)
               <span style="color: #888888"># next step</span>
               <span style="color: #008800; font-weight: bold">elif</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">230</span> <span style="color: #000000; font-weight: bold">and</span> more:
                  call(<span style="background-color: #fff0f0">&quot;kill -9 $(pgrep aplay)&quot;</span>,shell<span style="color: #333333">=</span><span style="color: #007020">True</span>) <span style="color: #888888"># stop speaking</span>
                  display_instruction(instructions,starti<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>,<span style="color: #007020">id</span>,speak)
            <span style="color: #888888">#toggle speech</span>
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">20</span> <span style="color: #000000; font-weight: bold">and</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">220</span>:
               <span style="color: #888888"># enable</span>
               <span style="color: #008800; font-weight: bold">if</span> speak <span style="color: #333333">==</span> <span style="color: #007020">False</span>:
                  speak <span style="color: #333333">=</span> <span style="color: #007020">True</span>
                  first <span style="color: #333333">=</span> <span style="color: #007020">True</span>
               <span style="color: #888888"># disable</span>
               <span style="color: #008800; font-weight: bold">else</span>:
                  call(<span style="background-color: #fff0f0">&quot;kill -9 $(pgrep aplay)&quot;</span>,shell<span style="color: #333333">=</span><span style="color: #007020">True</span>) <span style="color: #888888"># stop speaking</span>
                  speak <span style="color: #333333">=</span> <span style="color: #007020">False</span>
                  first <span style="color: #333333">=</span> <span style="color: #007020">False</span>

      screen<span style="color: #333333">.</span>fill(BLACK) <span style="color: #888888"># Erase the Work space</span>

      <span style="color: #888888"># display text items</span>
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> my_buttons<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> speech_button<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, button_color)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">25</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip()
      <span style="color: #888888"># start speaking</span>
      <span style="color: #008800; font-weight: bold">if</span> first <span style="color: #000000; font-weight: bold">and</span> speak:
         call([cmd_beg<span style="color: #333333">+</span>cmd_out<span style="color: #333333">+</span><span style="background-color: #fff0f0">&#39;&quot;&#39;</span><span style="color: #333333">+</span><span style="color: #007020">str</span>(instructions1)<span style="color: #333333">+</span><span style="background-color: #fff0f0">&#39;&quot;&#39;</span><span style="color: #333333">+</span>cmd_end], shell<span style="color: #333333">=</span><span style="color: #007020">True</span>)
         first<span style="color: #333333">=</span><span style="color: #007020">False</span>
   
<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">display_item_added</span>(item,<span style="color: #007020">id</span>):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Animates and displays the item added screen.</span>
<span style="color: #DD4422">   item is the name of the ingredient, and id is its id.</span>
<span style="color: #DD4422">   Called from home_screen() after the id of the scanned barcode has been obtained.</span>
<span style="color: #DD4422">   User specifies if correct and should be added to the Fridge</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   
   my_font <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">30</span>)
   my_font2 <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>font<span style="color: #333333">.</span>Font(<span style="color: #007020">None</span>,<span style="color: #0000DD; font-weight: bold">20</span>)
   
   <span style="color: #888888"># header</span>
   text_list<span style="color: #333333">=</span>{<span style="background-color: #fff0f0">&quot;Item Added!&quot;</span>:((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">10</span>)}
   text_list[<span style="background-color: #fff0f0">&quot;-&quot;</span><span style="color: #333333">*</span>WINDOW]<span style="color: #333333">=</span>((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">20</span>)

   <span style="color: #888888"># body</span>
   text_list2<span style="color: #333333">=</span>{item<span style="color: #333333">.</span>title() <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; added&quot;</span>:((WIDTH<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">2</span>),<span style="color: #0000DD; font-weight: bold">100</span>)}
   
   <span style="color: #888888">#static buttons</span>
   my_buttons <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;Incorrect?&#39;</span>:(<span style="color: #0000DD; font-weight: bold">75</span>,<span style="color: #0000DD; font-weight: bold">220</span>),
               <span style="background-color: #fff0f0">&#39;Correct?&#39;</span>:(<span style="color: #0000DD; font-weight: bold">250</span>,<span style="color: #0000DD; font-weight: bold">220</span>)}

   pos <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>) 
   
   <span style="color: #888888"># animate and get events</span>
   <span style="color: #008800; font-weight: bold">while</span>:
      <span style="color: #888888">#mouse/touchscreen input</span>
      <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
         <span style="color: #008800; font-weight: bold">if</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONDOWN):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
         <span style="color: #008800; font-weight: bold">elif</span>(event<span style="color: #333333">.</span>type <span style="color: #000000; font-weight: bold">is</span> MOUSEBUTTONUP):
            pos<span style="color: #333333">=</span>pygame<span style="color: #333333">.</span>mouse<span style="color: #333333">.</span>get_pos()
            x,y<span style="color: #333333">=</span>pos
            <span style="color: #888888">#Display Items</span>
            <span style="color: #008800; font-weight: bold">if</span> y<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">210</span>:
               <span style="color: #888888"># back to menu   </span>
               <span style="color: #008800; font-weight: bold">if</span> x<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">140</span>:
                  home_screen()
               <span style="color: #888888"># add the fridge and return to menu</span>
               <span style="color: #008800; font-weight: bold">elif</span> x<span style="color: #333333">&gt;</span><span style="color: #0000DD; font-weight: bold">190</span>:
                  add_to_fridge(<span style="color: #007020">id</span>)
                  home_screen()

      screen<span style="color: #333333">.</span>fill(BLACK) <span style="color: #888888"># Erase the Work space</span>
      <span style="color: #888888"># display text items</span>
      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> my_buttons<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font2<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         text_rect<span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">50</span>
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      <span style="color: #008800; font-weight: bold">for</span> my_text,text_pos <span style="color: #000000; font-weight: bold">in</span> text_list2<span style="color: #333333">.</span>items():
         text_surface <span style="color: #333333">=</span> my_font<span style="color: #333333">.</span>render(my_text, <span style="color: #007020">True</span>, WHITE)
         text_rect <span style="color: #333333">=</span> text_surface<span style="color: #333333">.</span>get_rect(center<span style="color: #333333">=</span>text_pos)
         screen<span style="color: #333333">.</span>blit(text_surface,text_rect)

      pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip()

<span style="color: #888888"># ---------------- Functional methods ---------------- #</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">scan</span>():
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   return UPC number if barcode detected. Return -1 if no barcode detected.</span>
<span style="color: #DD4422">   called from home_screen at regular intervals</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   <span style="color: #888888">#initialize camera</span>
   pygame<span style="color: #333333">.</span>init()
   pygame<span style="color: #333333">.</span>camera<span style="color: #333333">.</span>init()
   pygame<span style="color: #333333">.</span>camera<span style="color: #333333">.</span>list_cameras()
   cam <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>camera<span style="color: #333333">.</span>Camera(CAM_NAME, CAM_RES,<span style="background-color: #fff0f0">&#39;RGB&#39;</span>)
   
   <span style="color: #888888"># sometimes, USB camera is detected at /dev/video0, other times at /dev/video1</span>
   <span style="color: #008800; font-weight: bold">try</span>:
      cam<span style="color: #333333">.</span>start()
   <span style="color: #008800; font-weight: bold">except</span>:
      cam <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>camera<span style="color: #333333">.</span>Camera(<span style="background-color: #fff0f0">&#39;/dev/video1&#39;</span>, CAM_RES,<span style="background-color: #fff0f0">&#39;RGB&#39;</span>)
      cam<span style="color: #333333">.</span>start()

   time<span style="color: #333333">.</span>sleep(<span style="color: #6600EE; font-weight: bold">0.5</span>) 
   pygame_screen_image <span style="color: #333333">=</span> cam<span style="color: #333333">.</span>get_image() <span style="color: #888888">#get the image</span>
   cam<span style="color: #333333">.</span>stop()

   img_arr <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>surfarray<span style="color: #333333">.</span>array3d(pygame_screen_image)
   
   <span style="color: #888888">#convert to grayscale and cast to uint8 so zbar can interpret</span>
   img_arr <span style="color: #333333">=</span> np<span style="color: #333333">.</span>dot(img_arr[<span style="color: #333333">...</span>,:<span style="color: #0000DD; font-weight: bold">3</span>], [<span style="color: #6600EE; font-weight: bold">0.299</span>, <span style="color: #6600EE; font-weight: bold">0.587</span>, <span style="color: #6600EE; font-weight: bold">0.114</span>])
   img_arr<span style="color: #333333">=</span>img_arr<span style="color: #333333">.</span>astype(np<span style="color: #333333">.</span>uint8)
   
   <span style="color: #888888">#now that we have the image, scan for a barcode</span>
   scanner <span style="color: #333333">=</span> zbar<span style="color: #333333">.</span>Scanner()
   results <span style="color: #333333">=</span> scanner<span style="color: #333333">.</span>scan(img_arr)
   <span style="color: #008800; font-weight: bold">if</span> results<span style="color: #333333">==</span>[]:
      <span style="color: #008800; font-weight: bold">print</span> <span style="background-color: #fff0f0">&quot;no barcode found&quot;</span>
      <span style="color: #008800; font-weight: bold">return</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>
   <span style="color: #008800; font-weight: bold">else</span>:
      <span style="color: #008800; font-weight: bold">for</span> result <span style="color: #000000; font-weight: bold">in</span> results:
         <span style="color: #888888"># By default zbar returns barcode data as byte array, so decode byte array$</span>
         <span style="color: #888888">#print(result.type, result.data.decode(&quot;ascii&quot;), result.quality)</span>
         <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">int</span>(result<span style="color: #333333">.</span>data<span style="color: #333333">.</span>decode(<span style="background-color: #fff0f0">&quot;ascii&quot;</span>)) <span style="color: #888888">#return just the code as an int</span>
   
<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">get_item_name</span>(<span style="color: #007020">id</span>):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Gets the name of an item id from Postgres</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   <span style="color: #007020">id</span> <span style="color: #333333">=</span> <span style="color: #007020">str</span>(<span style="color: #007020">int</span>(<span style="color: #007020">id</span>)) <span style="color: #888888"># eliminate trailing decimals and cast to string</span>
   <span style="color: #888888"># connect to db</span>
   conn <span style="color: #333333">=</span> psycopg2<span style="color: #333333">.</span>connect(<span style="background-color: #fff0f0">&#39;dbname=grocery_guard&#39;</span>)
   cur <span style="color: #333333">=</span> conn<span style="color: #333333">.</span>cursor()
   <span style="color: #888888"># select name and quantity from barcodes table</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select name,quantity from codes where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">id</span>)
   data <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchone())
   name <span style="color: #333333">=</span> data[<span style="color: #0000DD; font-weight: bold">0</span>]
   
   <span style="color: #888888">#close connection</span>
   cur<span style="color: #333333">.</span>close()
   conn<span style="color: #333333">.</span>close()
   <span style="color: #008800; font-weight: bold">return</span> name<span style="color: #333333">.</span>title()

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">get_item_id</span>(name):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Gets the id of an item name from Postgres</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   <span style="color: #888888"># connect to db</span>
   conn <span style="color: #333333">=</span> psycopg2<span style="color: #333333">.</span>connect(<span style="background-color: #fff0f0">&#39;dbname=grocery_guard&#39;</span>)
   cur <span style="color: #333333">=</span> conn<span style="color: #333333">.</span>cursor()
   <span style="color: #888888"># select id from barcodes db</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select id from codes where name =&#39;</span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&#39;&quot;</span> <span style="color: #333333">%</span> name<span style="color: #333333">.</span>lower())
   data <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchone())
   <span style="color: #007020">id</span> <span style="color: #333333">=</span> data[<span style="color: #0000DD; font-weight: bold">0</span>]
   
   <span style="color: #888888"># close connection</span>
   cur<span style="color: #333333">.</span>close()
   conn<span style="color: #333333">.</span>close()
   <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">id</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">add_to_fridge</span>(<span style="color: #007020">id</span>):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Add an item id to the Fridge. Gets name, amount, exp length from codes table </span>
<span style="color: #DD4422">   and writes to fridge. Called from home_screen after a valid barcode is detected</span>
<span style="color: #DD4422">   and confirmed by the user.</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   <span style="color: #007020">id</span> <span style="color: #333333">=</span> <span style="color: #007020">str</span>(<span style="color: #007020">int</span>(<span style="color: #007020">id</span>))
   <span style="color: #888888"># connect to db</span>
   conn <span style="color: #333333">=</span> psycopg2<span style="color: #333333">.</span>connect(<span style="background-color: #fff0f0">&#39;dbname=grocery_guard&#39;</span>)
   cur <span style="color: #333333">=</span> conn<span style="color: #333333">.</span>cursor()
   <span style="color: #888888"># get name, amount, expiration length from codes</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select name,quantity,exp_days from codes where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">id</span>)
   data <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchone())
   name <span style="color: #333333">=</span> data[<span style="color: #0000DD; font-weight: bold">0</span>]
   <span style="color: #888888"># convert strings to ints</span>
   quantity <span style="color: #333333">=</span> <span style="color: #007020">int</span>(<span style="color: #007020">float</span>(data[<span style="color: #0000DD; font-weight: bold">1</span>]))   <span style="color: #888888">#amounts</span>
   exp_days <span style="color: #333333">=</span> <span style="color: #007020">int</span>(<span style="color: #007020">float</span>(data[<span style="color: #0000DD; font-weight: bold">2</span>]))   <span style="color: #888888">#expiration length</span>
   added <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;date &#39;&quot;</span> <span style="color: #333333">+</span> <span style="color: #007020">str</span>(datetime<span style="color: #333333">.</span>date<span style="color: #333333">.</span>today()) <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;&#39;&quot;</span> <span style="color: #888888">#date added</span>
   
   <span style="color: #888888">#check if already in fridge</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select exists(select 1 from fridge where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">)&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">id</span>)
   exists <span style="color: #333333">=</span> cur<span style="color: #333333">.</span>fetchone()[<span style="color: #0000DD; font-weight: bold">0</span>]
   <span style="color: #888888"># add amount to existing row</span>
   <span style="color: #008800; font-weight: bold">if</span> exists:
      cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select quantity from fridge where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">id</span>)
      amt <span style="color: #333333">=</span> <span style="color: #007020">int</span>(cur<span style="color: #333333">.</span>fetchone()[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">+</span>quantity)
      msg <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;update fridge set quantity = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span>(amt,<span style="color: #007020">id</span>)
   <span style="color: #888888"># insert new row</span>
   <span style="color: #008800; font-weight: bold">else</span>:
      <span style="color: #888888"># write to fridge id, name, quantity, added, exp_days</span>
      msg <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;insert into fridge values (</span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">, &#39;</span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&#39;, </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">, </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">, </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">)&quot;</span> <span style="color: #333333">%</span> (<span style="color: #007020">id</span>,name,quantity,added,exp_days)
   cur<span style="color: #333333">.</span>execute(msg)

   <span style="color: #888888"># commit the write</span>
   conn<span style="color: #333333">.</span>commit()

   <span style="color: #888888"># close connection</span>
   cur<span style="color: #333333">.</span>close()
   conn<span style="color: #333333">.</span>close()

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">update_fridge</span>(<span style="color: #007020">id</span>,amt):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Subtract an item quantity from the Fridge. Subtract amt from current amount of ingredient</span>
<span style="color: #DD4422">   id stored in the Fridge.</span>
<span style="color: #DD4422">   If amt&lt;=0, then delete the ingredient from the fridge.</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   
   <span style="color: #007020">id</span> <span style="color: #333333">=</span> <span style="color: #007020">str</span>(<span style="color: #007020">int</span>(<span style="color: #007020">id</span>))
   <span style="color: #888888"># connect to the db</span>
   conn <span style="color: #333333">=</span> psycopg2<span style="color: #333333">.</span>connect(<span style="background-color: #fff0f0">&#39;dbname=grocery_guard&#39;</span>)
   cur <span style="color: #333333">=</span> conn<span style="color: #333333">.</span>cursor()
   
   <span style="color: #888888">#check if ingredient in fridge</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select exists(select 1 from fridge where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">)&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">id</span>)
   exists <span style="color: #333333">=</span> cur<span style="color: #333333">.</span>fetchone()[<span style="color: #0000DD; font-weight: bold">0</span>]
   <span style="color: #008800; font-weight: bold">if</span> exists:
      <span style="color: #888888"># get amount currently in fridge</span>
      cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select quantity from fridge where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">id</span>)
      quantity <span style="color: #333333">=</span> <span style="color: #007020">int</span>(np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchone())[<span style="color: #0000DD; font-weight: bold">0</span>])
      <span style="color: #888888"># calculate the new amount</span>
      <span style="color: #008800; font-weight: bold">if</span> amt <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
         new_amt <span style="color: #333333">=</span> <span style="color: #007020">int</span>(quantity<span style="color: #333333">-</span>amt)
      <span style="color: #008800; font-weight: bold">else</span>:
         <span style="color: #888888"># if this update brings quantity negative, flag</span>
         new_amt <span style="color: #333333">=</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>

      <span style="color: #888888">#remove from fridge</span>
      <span style="color: #008800; font-weight: bold">if</span> new_amt <span style="color: #333333">&lt;=</span> <span style="color: #0000DD; font-weight: bold">0</span>:
         cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;delete from fridge where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">id</span>)
      <span style="color: #888888">#update fridge with new value</span>
      <span style="color: #008800; font-weight: bold">else</span>:
         cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;update fridge set quantity = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> (<span style="color: #007020">str</span>(new_amt),<span style="color: #007020">id</span>))

      <span style="color: #888888">#commit write</span>
      conn<span style="color: #333333">.</span>commit()

   <span style="color: #888888"># close connection</span>
   cur<span style="color: #333333">.</span>close()
   conn<span style="color: #333333">.</span>close()

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">get_ingredients</span>():
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Get list of ingredients and amounts currently contained in the Fridge.</span>
<span style="color: #DD4422">   Queries Postgres &#39;fridge&#39; table and formats ingredients as a numpy array.</span>
<span style="color: #DD4422">   Format of each entry is np.asarray([ing1,ing2,...])</span>
<span style="color: #DD4422">   where ingi = &quot;Name amt+unit time to expire in days&quot;</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   
   <span style="color: #888888"># connect to db</span>
   conn <span style="color: #333333">=</span> psycopg2<span style="color: #333333">.</span>connect(<span style="background-color: #fff0f0">&#39;dbname=grocery_guard&#39;</span>)
   cur <span style="color: #333333">=</span> conn<span style="color: #333333">.</span>cursor()
   <span style="color: #888888"># get name + amt + exp length + date added</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select name,quantity,added,exp_days from fridge&quot;</span>)
   f <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchall())
   ingredients <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray([])
   <span style="color: #888888"># parse query and format</span>
   <span style="color: #008800; font-weight: bold">for</span> ing <span style="color: #000000; font-weight: bold">in</span> f:
      name <span style="color: #333333">=</span> ing[<span style="color: #0000DD; font-weight: bold">0</span>]
      quantity <span style="color: #333333">=</span> ing[<span style="color: #0000DD; font-weight: bold">1</span>]
      added <span style="color: #333333">=</span> ing[<span style="color: #0000DD; font-weight: bold">2</span>]
      exp_on <span style="color: #333333">=</span> added <span style="color: #333333">+</span> datetime<span style="color: #333333">.</span>timedelta(ing[<span style="color: #0000DD; font-weight: bold">3</span>])
      days_to_exp <span style="color: #333333">=</span> exp_on <span style="color: #333333">-</span> datetime<span style="color: #333333">.</span>date<span style="color: #333333">.</span>today()

      msg <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39; &#39;</span><span style="color: #333333">.</span>join([name,<span style="color: #007020">str</span>(<span style="color: #007020">int</span>(quantity)),<span style="color: #007020">str</span>(days_to_exp)])
      ingredients <span style="color: #333333">=</span> np<span style="color: #333333">.</span>append(ingredients,msg)
   
   <span style="color: #888888"># close connection</span>
   cur<span style="color: #333333">.</span>close()
   conn<span style="color: #333333">.</span>close()
   <span style="color: #008800; font-weight: bold">return</span> ingredients
   
<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">get_recipes</span>():
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Get the top 5 matching recipes based on the ingredients currently in the Fridge.</span>
<span style="color: #DD4422">   Formats each recipe as np.asarray([[recipe1,recipe2,...],[id1,id2,...]])</span>
<span style="color: #DD4422">   where recipei = &#39;name %match&#39;</span>
<span style="color: #DD4422">   %match = #ing in fridge used by recipe/# total ing used by recipe</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>

   <span style="color: #888888"># initialize max overlap recipe tracking arrays</span>
   max_recipes <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray([<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>])  <span style="color: #888888">#IDs of max overlap recipes</span>
   max_overlap <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray([<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>])

   <span style="color: #888888"># connect tp db</span>
   conn <span style="color: #333333">=</span> psycopg2<span style="color: #333333">.</span>connect(<span style="background-color: #fff0f0">&#39;dbname=grocery_guard&#39;</span>)
   cur <span style="color: #333333">=</span> conn<span style="color: #333333">.</span>cursor()
   <span style="color: #888888"># get all item ids from fridge (as UPC numbers)</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select id from fridge&quot;</span>)
   I <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchall())
   <span style="color: #888888"># get all recipe ids from fride</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select id from recipes&quot;</span>)
   recipes <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchall())
   
   <span style="color: #888888">#get max recipe ID to use as loop control</span>
   cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select id from recipes where id = (select max(id) from recipes)&quot;</span>)
   num_recs <span style="color: #333333">=</span> <span style="color: #007020">int</span>(cur<span style="color: #333333">.</span>fetchone()[<span style="color: #0000DD; font-weight: bold">0</span>])
   
   <span style="color: #888888"># Determine amount of overlap with Fridge for each recipe in db</span>
   <span style="color: #008800; font-weight: bold">for</span> r <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">1</span>,num_recs<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>):
      <span style="color: #888888"># get ingredients+amounts from recipe r</span>
      cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select ingredients from recipes where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">str</span>(r))
      ri <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchone())[<span style="color: #0000DD; font-weight: bold">0</span>]  <span style="color: #888888">#ingredients for recipe r</span>
      cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select amounts from recipes where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">str</span>(r))
      ra <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray(cur<span style="color: #333333">.</span>fetchone())[<span style="color: #0000DD; font-weight: bold">0</span>]  <span style="color: #888888">#amounts for recipe r</span>
      
      <span style="color: #888888"># calculate the size of the overlap based on id</span>
      s <span style="color: #333333">=</span> np<span style="color: #333333">.</span>intersect1d(ri,I)
      n <span style="color: #333333">=</span> s<span style="color: #333333">.</span>size

      <span style="color: #888888"># if we don&#39;t contain enough of an ingredient, subtract from the size of the overlap</span>
      <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> s:
         <span style="color: #888888"># get index of i in recipe r&#39;s ingredient list</span>
         <span style="color: #888888"># ra[indr] = amount of ingredient i recipe r requires</span>
         indr <span style="color: #333333">=</span> np<span style="color: #333333">.</span>where(ri<span style="color: #333333">==</span>i)[<span style="color: #0000DD; font-weight: bold">0</span>][<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #888888"># index of i in r&#39;s ingredient list</span>
         
         <span style="color: #888888"># get amount of ingredient id from fridge</span>
         cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select quantity from fridge where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">str</span>(<span style="color: #007020">int</span>(i)))
         tmp <span style="color: #333333">=</span> cur<span style="color: #333333">.</span>fetchone()[<span style="color: #0000DD; font-weight: bold">0</span>]
         
         <span style="color: #888888"># if amount we have &lt; amount we need, deincrement n</span>
         <span style="color: #008800; font-weight: bold">if</span> tmp <span style="color: #333333">&lt;</span> ra[indr] :
            n<span style="color: #333333">-=</span><span style="color: #0000DD; font-weight: bold">1</span>
      
      <span style="color: #888888"># current minially overlapping recipe as a percentage</span>
      m <span style="color: #333333">=</span> np<span style="color: #333333">.</span>min(max_overlap)

      n <span style="color: #333333">=</span> <span style="color: #007020">float</span>(n)<span style="color: #333333">/</span>ra<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #888888">#convert to percentage</span>

      <span style="color: #888888"># if recipe r overlaps more than minimum overlapping recipe, add r to sugggestion list</span>
      <span style="color: #008800; font-weight: bold">if</span> n <span style="color: #333333">&gt;</span> m:
         ind <span style="color: #333333">=</span> np<span style="color: #333333">.</span>where(max_overlap<span style="color: #333333">==</span>m)[<span style="color: #0000DD; font-weight: bold">0</span>][<span style="color: #0000DD; font-weight: bold">0</span>]
         max_overlap <span style="color: #333333">=</span> np<span style="color: #333333">.</span>delete(max_overlap,ind)
         max_overlap <span style="color: #333333">=</span> np<span style="color: #333333">.</span>append(max_overlap,n)
         max_recipes <span style="color: #333333">=</span> np<span style="color: #333333">.</span>delete(max_recipes,ind)
         max_recipes <span style="color: #333333">=</span> np<span style="color: #333333">.</span>append(max_recipes,r)

   <span style="color: #888888">#get recipe names</span>
   names <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray([])
   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(max_recipes<span style="color: #333333">.</span>size):
      cur<span style="color: #333333">.</span>execute(<span style="background-color: #fff0f0">&quot;select name from recipes where id = </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&quot;</span> <span style="color: #333333">%</span> <span style="color: #007020">str</span>(max_recipes[i]))
      <span style="color: #008800; font-weight: bold">try</span>:
         result <span style="color: #333333">=</span> cur<span style="color: #333333">.</span>fetchone()[<span style="color: #0000DD; font-weight: bold">0</span>]
      <span style="color: #888888"># case where fewer than 5 recipes are suggested</span>
      <span style="color: #008800; font-weight: bold">except</span>:
         result <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39; &#39;</span>
      names <span style="color: #333333">=</span> np<span style="color: #333333">.</span>append(names,result <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; &#39;</span> <span style="color: #333333">+</span> <span style="color: #007020">str</span>(max_overlap[i]))

   <span style="color: #008800; font-weight: bold">return</span> np<span style="color: #333333">.</span>asarray([names,max_recipes])

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">get_notifications</span>(ingredients):
   <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">   Compute notifications based on ingredients list.</span>
<span style="color: #DD4422">   ingredients must be formatted as a numpy array:</span>
<span style="color: #DD4422">      ingredients = np.asarray([ing1,ing2,ing3,...])</span>
<span style="color: #DD4422">      where ingi = &quot;Name amt+unit time to expire in days&quot;</span>
<span style="color: #DD4422">   Notifications include:</span>
<span style="color: #DD4422">      item running low</span>
<span style="color: #DD4422">      item about to expire</span>
<span style="color: #DD4422">      item expired</span>
<span style="color: #DD4422">   &quot;&quot;&quot;</span>
   EXP_DAYS <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">5</span> <span style="color: #888888">#number of days til expiration to trigger notification</span>
   ING_LOW <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">5</span> <span style="color: #888888">#number of ingredient units to trigger notification</span>
   notifications <span style="color: #333333">=</span> np<span style="color: #333333">.</span>asarray([])

   <span style="color: #888888"># determine notifications for each ingredient</span>
   <span style="color: #008800; font-weight: bold">for</span> ing <span style="color: #000000; font-weight: bold">in</span> ingredients:
      <span style="color: #888888">#parse ingredient into name, amount, exp days</span>
      ing_list <span style="color: #333333">=</span> ing<span style="color: #333333">.</span>split()
      name <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot; &quot;</span><span style="color: #333333">.</span>join(ing_list[:<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">4</span>])
      amount <span style="color: #333333">=</span> ing_list[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">4</span>]
      exp <span style="color: #333333">=</span> ing_list[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">3</span>]
      
      <span style="color: #888888"># ingredient low</span>
      <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">int</span>(amount) <span style="color: #333333">&lt;=</span> ING_LOW:
         msg <span style="color: #333333">=</span> name <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;;low&quot;</span>
         notifications <span style="color: #333333">=</span> np<span style="color: #333333">.</span>append(notifications, msg)
      <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">int</span>(exp) <span style="color: #333333">&lt;=</span> EXP_DAYS:
         <span style="color: #888888"># ingredient expired</span>
         <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">int</span>(exp) <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            msg <span style="color: #333333">=</span> name <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;;expired &quot;</span> <span style="color: #333333">+</span> <span style="color: #007020">str</span>(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #007020">int</span>(exp)) <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; days ago&quot;</span>
         <span style="color: #888888"># ingredient about to expire</span>
         <span style="color: #008800; font-weight: bold">else</span>:
            msg <span style="color: #333333">=</span> name <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;;expiring in &quot;</span> <span style="color: #333333">+</span> exp <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; days&quot;</span>
         notifications <span style="color: #333333">=</span> np<span style="color: #333333">.</span>append(notifications, msg)

   <span style="color: #008800; font-weight: bold">return</span> notifications

<span style="color: #008800; font-weight: bold">if</span> __name__ <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;__main__&quot;</span>:
      <span style="color: #DD4422">&quot;&quot;&quot;Driver&quot;&quot;&quot;</span>
      <span style="color: #888888"># default to home screen</span>
      home_screen()
</pre></td></tr></table></div>
